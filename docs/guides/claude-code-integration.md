# Claude Code Integration Guide

## Claude Code Agent Teams 활용 패턴

### 1. Task 도구로 에이전트 실행

```python
# PM Agent가 Design Team 활성화
async def run_design_phase(user_request: str):
    """디자인 단계 실행 (병렬)"""

    # Claude Code Task 도구 사용 (병렬 실행)
    design_results = await claude_code.run_parallel_tasks([
        {
            "subagent_type": "general-purpose",
            "description": "Design game concept",
            "prompt": f"""
You are the Concept Designer agent for CAISOGAMES V2.

User request: {user_request}

Design the core game mechanics:
1. Genre and core gameplay loop
2. Player abilities (2-5)
3. Unique mechanics
4. Difficulty curve
5. Win/lose conditions

Output as JSON following ConceptDesignerOutput schema:
{{
  "concept": {{
    "title": "...",
    "genre": "...",
    "coreLoop": ["...", "..."],
    "playerAbilities": [...]
  }}
}}
"""
        },
        {
            "subagent_type": "general-purpose",
            "description": "Design game levels",
            "prompt": f"""
You are the Level Designer agent.

Based on the concept (will be injected after concept design completes),
design 3 levels with progressive difficulty.

Output as JSON following LevelDesignerOutput schema.
"""
        },
        {
            "subagent_type": "general-purpose",
            "description": "Write game narrative",
            "prompt": f"""
You are the Narrative Designer agent.

Create world setting, characters, and dialogue for the game.

Output as JSON following NarrativeOutput schema.
"""
        }
    ])

    return design_results
```

### 2. 파일 시스템 통합

```python
# 에이전트가 생성한 파일 저장
async def save_generated_assets(assets: list[GeneratedAsset]):
    """생성된 에셋 저장 (Claude Code Write 도구)"""

    for asset in assets:
        # 이미지 저장
        await claude_code.write_file(
            file_path=asset.image['path'],
            content=asset.image_data  # base64 or binary
        )

        # 메타데이터 저장
        metadata_path = asset.image['path'].replace('.png', '.json')
        await claude_code.write_file(
            file_path=metadata_path,
            content=json.dumps(asset.metadata, indent=2)
        )
```

### 3. Git 자동 커밋

```python
async def commit_milestone(milestone: str, files: list[str]):
    """마일스톤 달성 시 자동 커밋"""

    await claude_code.bash(f"git add {' '.join(files)}")
    await claude_code.bash(f"""git commit -m "✨ {milestone}

Generated by CAISOGAMES V2 AI Agents

- Assets: {len(files)} files
- Quality: Validated
- Milestone: {milestone}
" """)
```

### 4. 전체 워크플로우 오케스트레이션

```python
class ProjectManagerAgent:
    """PM Agent - Claude Code 통합 버전"""

    async def orchestrate_game_development(self, user_request: str):
        """전체 게임 개발 프로세스 조율"""

        # Phase 1: Design
        design = await self.run_design_phase(user_request)

        # Phase 2: Assets (병렬)
        assets = await claude_code.run_parallel_tasks([
            {
                "subagent_type": "general-purpose",
                "description": "Generate sprites",
                "prompt": self.build_art_prompt(design, "sprites")
            },
            {
                "subagent_type": "general-purpose",
                "description": "Generate audio",
                "prompt": self.build_art_prompt(design, "audio")
            }
        ])

        # Phase 3: Code
        code = await claude_code.run_task(
            subagent_type="general-purpose",
            description="Generate game code",
            prompt=self.build_code_prompt(design, assets)
        )

        # Phase 4: QA
        qa = await claude_code.run_task(
            subagent_type="general-purpose",
            description="Run tests",
            prompt=self.build_qa_prompt(code)
        )

        # Phase 5: Deploy
        if qa['all_passed']:
            deploy_url = await self.deploy_game(code)
            return deploy_url
        else:
            await self.fix_bugs(qa['bugs'])
```

---

**문서 버전:** 1.0
